     1                                 %line 1+1 ast11.asm
     2                                 
     3                                 
     4                                 
     5                                 
     6                                 
     7                                 
     8                                 
     9                                 
    10                                 
    11                                 
    12                                 
    13                                 
    14                                 
    15                                 
    16                                 
    17                                 
    18                                 
    19                                 
    20                                 
    21                                 
    22                                 [section .data]
    23                                 
    24                                 
    25                                 
    26                                 
    27                                 LF equ 10
    28                                 NULL equ 0
    29                                 SPACE equ 0x20
    30                                 
    31                                 TRUE equ 1
    32                                 FALSE equ 0
    33                                 
    34                                 EXIT_SUCCESS equ 0
    35                                 EXIT_NOSUCCESS equ 1
    36                                 
    37                                 STDIN equ 0
    38                                 STDOUT equ 1
    39                                 STDERR equ 2
    40                                 
    41                                 SYS_read equ 0
    42                                 SYS_write equ 1
    43                                 SYS_open equ 2
    44                                 SYS_close equ 3
    45                                 SYS_fork equ 57
    46                                 SYS_exit equ 60
    47                                 SYS_creat equ 85
    48                                 SYS_time equ 201
    49                                 
    50                                 O_CREAT equ 0x40
    51                                 O_TRUNC equ 0x200
    52                                 O_APPEND equ 0x400
    53                                 
    54                                 O_RDONLY equ 000000
    55                                 O_WRONLY equ 000001
    56                                 O_RDWR equ 000002
    57                                 
    58                                 S_IRUSR equ 00400
    59                                 S_IWUSR equ 00200
    60                                 S_IXUSR equ 00100
    61                                 
    62                                 
    63                                 
    64                                 
    65 00000000 55736167653A202E2F-    usageMsg db "Usage: ./benford -i <inputFileName> "
    66 00000000 62656E666F7264202D-
    67 00000000 69203C696E70757446-
    68 00000000 696C654E616D653E20 
    69 00000024 2D6F203C6F75747075-     db "-o <outputFileName> -d <T/F>", LF, NULL
    70 00000024 7446696C654E616D65-
    71 00000024 3E202D64203C542F46-
    72 00000024 3E0A00             
    73                                 
    74 00000042 4572726F722C20746F-    errMany db "Error, too many characters on the "
    75 00000042 6F206D616E79206368-
    76 00000042 617261637465727320-
    77 00000042 6F6E2074686520     
    78 00000064 636F6D6D616E64206C-     db "command line.", LF, NULL
    79 00000064 696E652E0A00       
    80                                 
    81 00000073 4572726F722C20746F-    errFew db "Error, too few characters on the "
    82 00000073 6F2066657720636861-
    83 00000073 72616374657273206F-
    84 00000073 6E2074686520       
    85 00000094 636F6D6D616E64206C-     db "command line.", LF, NULL
    86 00000094 696E652E0A00       
    87                                 
    88 000000A3 4572726F722C20696E-    errDSpec db "Error, invalid output display specifier."
    89 000000A3 76616C6964206F7574-
    90 000000A3 70757420646973706C-
    91 000000A3 617920737065636966-
    92 000000A3 6965722E           
    93 000000CB 0A00                    db LF, NULL
    94                                 
    95 000000CD 4572726F722C20696E-    errISpec db "Error, invalid input file specifier."
    96 000000CD 76616C696420696E70-
    97 000000CD 75742066696C652073-
    98 000000CD 70656369666965722E 
    99 000000F1 0A00                    db LF, NULL
   100                                 
   101 000000F3 4572726F722C20696E-    errOSpec db "Error, invalid output file specifier."
   102 000000F3 76616C6964206F7574-
   103 000000F3 7075742066696C6520-
   104 000000F3 737065636966696572-
   105 000000F3 2E                 
   106 00000118 0A00                    db LF, NULL
   107                                 
   108 0000011A 4572726F722C20696E-    errTF db "Error, invalid display option. Must be T or F."
   109 0000011A 76616C696420646973-
   110 0000011A 706C6179206F707469-
   111 0000011A 6F6E2E204D75737420-
   112 0000011A 62652054206F722046-
   113 0000011A 2E                 
   114 00000148 0A00                    db LF, NULL
   115                                 
   116 0000014A 4572726F722C206361-    errOpenIn db "Error, can not open input file."
   117 0000014A 6E206E6F74206F7065-
   118 0000014A 6E20696E7075742066-
   119 0000014A 696C652E           
   120 00000169 0A00                    db LF, NULL
   121                                 
   122 0000016B 4572726F722C206361-    errOpenOut db "Error, can not open output file."
   123 0000016B 6E206E6F74206F7065-
   124 0000016B 6E206F757470757420-
   125 0000016B 66696C652E         
   126 0000018B 0A00                    db LF, NULL
   127                                 
   128 0000018D 0000000000000000       rdFileDescriptor dq 0
   129 00000195 0000000000000000       wrFileDescriptor dq 0
   130                                 
   131                                 
   132                                 
   133                                 
   134                                 BUFFSIZE equ 500000
   135                                 
   136                                 SKIP_LINES equ 5
   137                                 SKIP_CHARS equ 6
   138                                 
   139 0000019D 01                     nextCharIsFirst db TRUE
   140 0000019E 00000000               skipLineCount dd 0
   141 000001A2 00000000               skipCharCount dd 0
   142 000001A6 00                     gotDigit db FALSE
   143                                 
   144 000001A7 20A1070000000000       bfMax dq BUFFSIZE
   145 000001AF 20A1070000000000       curr dq BUFFSIZE
   146                                 
   147 000001B7 00                     wasEOF db FALSE
   148                                 
   149 000001B8 4572726F7220726561-    errFileRead db "Error reading input file."
   150 000001B8 64696E6720696E7075-
   151 000001B8 742066696C652E     
   152 000001D1 50726F6772616D2074-     db "Program terminated."
   153 000001D1 65726D696E61746564-
   154 000001D1 2E                 
   155 000001E4 0A00                    db LF, NULL
   156                                 
   157                                 
   158                                 
   159                                 
   160                                 SCALE1 equ 100
   161                                 SCALE2 equ 1000
   162                                 SCALE3 equ 2500
   163                                 SCALE4 equ 5000
   164                                 
   165 000001E6 64000000               scale dd SCALE1
   166                                 
   167 000001EA 03000000               weight dd 3
   168                                 
   169 000001EE 4572726F7220777269-    errFileWrite db "Error writting output file."
   170 000001EE 7474696E67206F7574-
   171 000001EE 7075742066696C652E 
   172 00000209 0A00                    db LF, NULL
   173                                 
   174 0000020B 0A4353203231382042-    graphHeader db LF, "CS 218 Benfords Law", LF
   175 0000020B 656E666F726473204C-
   176 0000020B 61770A             
   177 00000220 546573742052657375-     db "Test Results", LF, LF, NULL
   178 00000220 6C74730A0A00       
   179                                 
   180 0000022F 546F74616C20446174-    graphLine1 db "Total Data Points: "
   181 0000022F 6120506F696E74733A-
   182 0000022F 20                 
   183 00000242 202020202020202020-    tStr1 db "                     ", LF, LF, NULL
   184 00000242 202020202020202020-
   185 00000242 2020200A0A00       
   186                                 
   187                                 DIGITS_SIZE equ 15
   188                                 STARS_SIZE equ 50
   189                                 
   190 0000025A 2020                   graphLine2 db "  "
   191 0000025C 78                     index2 db "x"
   192 0000025D 2020                    db "  "
   193 0000025F 202020202020202020-    num2 db "               "
   194 0000025F 202020202020       
   195 0000026E 7C                      db "|"
   196 0000026F 202020202020202020-    stars2 db "                              "
   197 0000026F 202020202020202020-
   198 0000026F 202020202020202020-
   199 0000026F 202020             
   200 0000028D 202020202020202020-     db "                    "
   201 0000028D 202020202020202020-
   202 0000028D 2020               
   203 000002A1 0A00                    db LF, NULL
   204                                 
   205 000002A3 202020202020202020-    graphLine3 db "                     ---------------------------------------------"
   206 000002A3 202020202020202020-
   207 000002A3 2020202D2D2D2D2D2D-
   208 000002A3 2D2D2D2D2D2D2D2D2D-
   209 000002A3 2D2D2D2D2D2D2D2D2D-
   210 000002A3 2D2D2D2D2D2D2D2D2D-
   211 000002A3 2D2D2D2D2D2D2D2D2D-
   212 000002A3 2D2D2D             
   213 000002E5 0A0A00                  db LF, LF, NULL
   214                                 
   215                                 
   216                                 
   217                                 
   218                                 [section .bss]
   219                                 
   220 00000000 <gap>                  buff resb BUFFSIZE+1
   221                                 
   222                                 
   223                                 
   224                                 
   225                                 [section .text]
   226                                 
   227                                 
   228                                 
   229                                 
   230                                 
   231                                 
   232                                 
   233                                 
   234                                 
   235                                 
   236                                 
   237                                 
   238                                 
   239                                 
   240                                 
   241                                 
   242                                 
   243                                 
   244                                 
   245                                 
   246                                 
   247                                 
   248                                 
   249                                 
   250                                 
   251                                 
   252                                 
   253                                 [global getArguments]
   254                                  getArguments:
   255                                 
   256 00000000 53                      push rbx
   257 00000001 4154                    push r12
   258 00000003 4155                    push r13
   259 00000005 4156                    push r14
   260                                 
   261 00000007 4989F4                  mov r12, rsi
   262 0000000A 4989D5                  mov r13, rdx
   263 0000000D 4989CE                  mov r14, rcx
   264                                 
   265                                 
   266 00000010 4883FF01                cmp rdi, 1
   267 00000014 0F84A7000000            je usage
   268                                 
   269                                 
   270 0000001A 4883FF07                cmp rdi, 7
   271 0000001E 0F8FB5000000            jg many
   272                                 
   273                                 
   274 00000024 4883FF07                cmp rdi, 7
   275 00000028 0F8CC3000000            jl few
   276                                 
   277                                 
   278 0000002E 498B5C2408              mov rbx, qword[r12+8]
   279 00000033 66813B2D69              cmp word[rbx], 0x692d
   280 00000038 0F85CB000000            jne invalidInputSpecifier
   281                                 
   282                                 
   283 0000003E 48C7C002000000          mov rax, SYS_open
   284 00000045 498B7C2410              mov rdi, qword[r12+16]
   285 0000004A 48C7C600000000          mov rsi, O_RDONLY
   286 00000051 0F05                    syscall
   287                                 
   288 00000053 4883F800                cmp rax, 0
   289 00000057 0F8CC4000000            jl errorOnInputFile
   290                                 
   291 0000005D 49894500                mov qword[r13], rax
   292 00000061 48890425[00000000]      mov qword[rdFileDescriptor], rax
   293                                 
   294                                 
   295 00000069 498B5C2418              mov rbx, qword[r12+24]
   296 0000006E 66813B2D6F              cmp word[rbx], 0x6f2d
   297 00000073 0F85C0000000            jne invalidOutputSpecifier
   298                                 
   299                                 
   300 00000079 48C7C002000000          mov rax, SYS_open
   301 00000080 498B7C2420              mov rdi, qword[r12+32]
   302 00000085 48C7C600000000          mov rsi, O_RDONLY
   303 0000008C 0F05                    syscall
   304                                 
   305 0000008E 4883F800                cmp rax, 0
   306 00000092 0F8CB6000000            jl errorOnOutputFile
   307                                 
   308 00000098 498906                  mov qword[r14], rax
   309                                 
   310                                 
   311 0000009B 498B5C2428              mov rbx, qword[r12+40]
   312 000000A0 66813B2D64              cmp word[rbx], 0x642d
   313 000000A5 0F85B8000000            jne invalidDisplaySpecifier
   314                                 
   315                                 
   316 000000AB 498B5C2430              mov rbx, qword[r12+48]
   317                                 
   318                                 
   319 000000B0 803B54                  cmp byte[rbx], 0x54
   320 000000B3 0F84BF000000            je displayTrue
   321                                 
   322 000000B9 803B46                  cmp byte[rbx], 0x46
   323 000000BC 0F84D2000000            je displayFalse
   324                                 
   325                                 
   326                                 
   327 000000C2 E9DE000000              jmp invalidDisplayOption
   328                                 
   329                                 
   330                                  usage:
   331 000000C7 48C7C7[00000000]        mov rdi, usageMsg
   332 000000CE E8F1000000              call printString
   333 000000D3 48C7C000000000          mov rax, FALSE
   334 000000DA E9DB000000              jmp argsDone
   335                                 
   336                                  many:
   337 000000DF 48C7C7[00000000]        mov rdi, errMany
   338 000000E6 E8D9000000              call printString
   339 000000EB 48C7C000000000          mov rax, FALSE
   340 000000F2 E9C3000000              jmp argsDone
   341                                 
   342                                  few:
   343 000000F7 48C7C7[00000000]        mov rdi, errFew
   344 000000FE E8C1000000              call printString
   345 00000103 48C7C000000000          mov rax, FALSE
   346 0000010A E9AB000000              jmp argsDone
   347                                 
   348                                  invalidInputSpecifier:
   349 0000010F 48C7C7[00000000]        mov rdi, errISpec
   350 00000116 E8A9000000              call printString
   351 0000011B 48C7C000000000          mov rax, FALSE
   352 00000122 E993000000              jmp argsDone
   353                                 
   354                                  errorOnInputFile:
   355 00000127 48C7C7[00000000]        mov rdi, errOpenIn
   356 0000012E E891000000              call printString
   357 00000133 48C7C000000000          mov rax, FALSE
   358 0000013A E97B000000              jmp argsDone
   359                                 
   360                                  invalidOutputSpecifier:
   361 0000013F 48C7C7[00000000]        mov rdi, errOSpec
   362 00000146 E879000000              call printString
   363 0000014B 48C7C000000000          mov rax, FALSE
   364 00000152 EB69                    jmp argsDone
   365                                 
   366                                  errorOnOutputFile:
   367 00000154 48C7C7[00000000]        mov rdi, errOpenOut
   368 0000015B E864000000              call printString
   369 00000160 48C7C000000000          mov rax, FALSE
   370 00000167 EB54                    jmp argsDone
   371                                 
   372                                  invalidDisplaySpecifier:
   373 00000169 48C7C7[00000000]        mov rdi, errDSpec
   374 00000170 E84F000000              call printString
   375 00000175 48C7C000000000          mov rax, FALSE
   376 0000017C EB3F                    jmp argsDone
   377                                 
   378                                  displayTrue:
   379 0000017E 49C70001000000          mov qword[r8], TRUE
   380 00000185 48C7C001000000          mov rax, TRUE
   381 0000018C 488B1C25[00000000]      mov rbx, qword[rdFileDescriptor]
   382 00000194 49895D00                mov qword[r13], rbx
   383 00000198 EB23                    jmp argsDone
   384                                 
   385                                  displayFalse:
   386 0000019A 49C70000000000          mov qword[r8], FALSE
   387 000001A1 48C7C001000000          mov rax, TRUE
   388 000001A8 EB13                    jmp argsDone
   389                                 
   390                                  invalidDisplayOption:
   391 000001AA 48C7C7[00000000]        mov rdi, errTF
   392 000001B1 E80E000000              call printString
   393 000001B6 48C7C000000000          mov rax, FALSE
   394 000001BD EBFE                    jmp argsDone
   395                                 
   396                                  argsDone:
   397                                 
   398 000001BF 415E                    pop r14
   399 000001C1 415D                    pop r13
   400 000001C3 415C                    pop r12
   401 000001C5 5B                      pop rbx
   402 000001C6 C3                      ret
   403                                 
   404                                 
   405                                 
   406                                 
   407                                 
   408                                 
   409                                 
   410                                 
   411                                 
   412                                 
   413                                 
   414                                 
   415                                 
   416                                 
   417                                 
   418                                 
   419                                 
   420                                 
   421                                 
   422                                 
   423                                 
   424                                 
   425                                 
   426                                 
   427                                 
   428                                 
   429                                 
   430                                 
   431                                 
   432                                 
   433                                 
   434                                 
   435                                 
   436                                 
   437                                 
   438                                 
   439                                 
   440                                 
   441                                 
   442                                 
   443                                 
   444                                 
   445                                 
   446                                 
   447                                 
   448                                 
   449                                 
   450                                 [global countDigits]
   451                                 countDigits:
   452                                 
   453                                 
   454                                 
   455                                 
   456 000001C7 C3                     ret
   457                                 
   458                                 
   459                                 
   460                                 
   461                                 
   462                                 
   463                                 
   464                                 
   465                                 
   466                                 
   467                                 
   468                                 
   469                                 
   470                                 
   471                                 
   472                                 
   473                                 
   474                                 
   475                                 [global showGraph]
   476                                 showGraph:
   477                                 
   478                                 
   479 000001C8 C3                     ret
   480                                 
   481                                 
   482                                 
   483                                 
   484                                 
   485                                 
   486                                 
   487                                 
   488                                 
   489                                 
   490                                 
   491                                 
   492                                 
   493                                 
   494                                 
   495                                 
   496                                 
   497                                 
   498                                 
   499                                 
   500                                 
   501                                 
   502                                 
   503                                 
   504                                 
   505                                 
   506                                 
   507                                 
   508                                 
   509                                 
   510                                 
   511                                 
   512                                 
   513                                 
   514                                 
   515                                 
   516                                 
   517                                 
   518                                 
   519                                 [global printString]
   520                                 printString:
   521                                 
   522                                 
   523                                 
   524                                 
   525 000001C9 48C7C200000000          mov rdx, 0
   526                                 strCountLoop:
   527 000001D0 803C1700                cmp byte [rdi+rdx], NULL
   528 000001D4 7403                    je strCountLoopDone
   529 000001D6 48FFC2                  inc rdx
   530 000001D9 EBF3                    jmp strCountLoop
   531                                 strCountLoopDone:
   532 000001DB 4883FA00                cmp rdx, 0
   533 000001DF 7411                    je printStringDone
   534                                 
   535                                 
   536                                 
   537                                 
   538 000001E1 48C7C001000000          mov rax, SYS_write
   539 000001E8 4889FE                  mov rsi, rdi
   540 000001EB 48C7C701000000          mov rdi, STDOUT
   541                                 
   542 000001F2 0F05                    syscall
   543                                 
   544                                 
   545                                 
   546                                 
   547                                 printStringDone:
   548 000001F4 C3                      ret
   549                                 
   550                                 
   551                                 
